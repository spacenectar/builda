#! /usr/bin/env node
"use strict";var fo=Object.create;var Ee=Object.defineProperty;var mo=Object.getOwnPropertyDescriptor;var go=Object.getOwnPropertyNames;var ho=Object.getPrototypeOf,yo=Object.prototype.hasOwnProperty;var bo=(e,t)=>{for(var r in t)Ee(e,r,{get:t[r],enumerable:!0})},tr=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of go(t))!yo.call(e,i)&&i!==r&&Ee(e,i,{get:()=>t[i],enumerable:!(o=mo(t,i))||o.enumerable});return e};var c=(e,t,r)=>(r=e!=null?fo(ho(e)):{},tr(t||!e||!e.__esModule?Ee(r,"default",{value:e,enumerable:!0}):r,e)),wo=e=>tr(Ee({},"__esModule",{value:!0}),e);var mi={};bo(mi,{builda:()=>Vt,buildaQuestion:()=>Qt,buildaSubstitute:()=>Kt,changeCase:()=>$,default:()=>fi,printMessage:()=>p,throwError:()=>l});module.exports=wo(mi);var uo=c(require("yargs")),po=c(require("chalk"));var g={version:"5.2.0",buildaDir:".builda",websiteUrl:"https://www.builda.app",buildaReadmeFileName:"getting-started.md",repository:{type:"git",url:"git+https://github.com/spacenectar/builda"}};var Ur=c(require("execa")),Jr=c(require("inquirer")),yt=c(require("fs")),Ue=c(require("path")),Je=c(require("process"));var Fe=c(require("chalk"));var ne=()=>console.log(Fe.default.magenta(`
  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 ${Fe.default.white(`v${g.version}
`)}
  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584  \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588      \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584   \u2584\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588
  \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588      \u2588\u2588\u2588   \u2580\u2588\u2588\u2588 \u2588\u2588\u2588\u2580   \u2588\u2588\u2588
  \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588      \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588    \u2588\u2588\u2588
  \u2588\u2588\u2588\u2584\u2584\u2584\u2588\u2588\u2580  \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588      \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588    \u2588\u2588\u2588
  \u2588\u2588\u2588\u2580\u2580\u2580\u2588\u2588\u2584  \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588      \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588
  \u2588\u2588\u2588    \u2588\u2588\u2584 \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588      \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588    \u2588\u2588\u2588
  \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588      \u2588\u2588\u2588   \u2584\u2588\u2588\u2588 \u2588\u2588\u2588    \u2588\u2588\u2588
  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2580   \u2580\u2588\u2588\u2588\u2588\u2588\u2588\u2580  \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2580  \u2588\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588

  ${Fe.default.white.bold("The Everything Generator")} \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588
`));var S=c(require("chalk")),Qe=c(require("process")),Ze=c(require("readline")),xo={interval:80,frames:["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"]},Ne=Qe.default.stdout,vo=Qe.default.stderr,K,$o=(e,t,r)=>{let o=null;if(t&&t==="error"&&(K!==void 0&&clearInterval(K),o=S.default.red(`\u{1F6A8} ${e}`)),t&&t==="danger"&&(o=S.default.red(`${e}`)),t&&t==="warning"&&(o=S.default.yellow(`\u{1F514} ${e}`)),t&&t==="config"&&(o=S.default.blue(`\u{1F527} ${e}`)),t&&t==="downloading"&&(o=S.default.blue(`\u{1F30D} ${e}`)),t&&t==="copying"&&(o=S.default.blue(`\u{1F4C2} ${e}`)),t&&t==="installing"&&(o=S.default.blue(`\u{1F4E6} ${e}`)),t&&t==="notice"&&(o=S.default.blue(`\u{1F4DD} ${e}`)),t&&t==="info"&&(o=S.default.bgHex("#6699CC").white.bold(" i ")+" "+S.default.reset.blue(e)),t&&t==="success"&&(K!==void 0&&clearInterval(K),o=S.default.green(`\u2705 ${e}`)),t&&t==="watch"&&(o=S.default.magenta(`\u{1F440} ${e}`)),t&&t==="build"&&(o=S.default.magenta(`\u{1F3D7} ${e}`)),t&&t==="run"&&(o=S.default.magenta(`\u{1F3C3} ${e}`)),t&&t==="primary"&&(o=S.default.magenta(`${e}`)),t&&t==="secondary"&&(o=S.default.white(`${e}`)),t&&t==="processing"){let s=xo,n=s.frames,a=s.interval,u=0;K!==void 0&&clearInterval(K),K=setInterval(()=>{let d=n[u];d==null&&(u=0,d=n[u]),Ze.default.clearLine(Ne,0),Ze.default.cursorTo(Ne,0),Ne.write(d),u=u>=n.length?0:u+1},a),o=S.default.blue(`${e}`)}return t||(o=e),r?o:(t==="error"?vo:Ne).write(`${o}
`)},p=$o;var lr=c(require("chalk"));var Ke=["adorable","adventurous","aggressive","agreeable","alert","alive","amused","angry","annoyed","annoying","anxious","arrogant","ashamed","attractive","average","awful","bad","beautiful","better","bewildered","black","bloody","blue","blue-eyed","blushing","bored","brainy","brave","breakable","bright","busy","calm","careful","cautious","charming","cheerful","clean","clear","clever","cloudy","clumsy","colorful","combative","comfortable","concerned","condemned","confused","cooperative","courageous","crazy","creepy","crowded","cruel","curious","cute","dangerous","dark","dead","defeated","defiant","delightful","depressed","determined","different","difficult","disgusted","distinct","disturbed","dizzy","doubtful","drab","dull","eager","easy","elated","elegant","embarrassed","enchanting","encouraging","energetic","enthusiastic","envious","evil","excited","expensive","exuberant","fair","faithful","famous","fancy","fantastic","fierce","filthy","fine","foolish","fragile","frail","frantic","friendly","frightened","funny","gentle","gifted","glamorous","gleaming","glorious","good","gorgeous","graceful","grieving","grotesque","grumpy","handsome","happy","healthy","helpful","helpless","hilarious","homeless","homely","horrible","hungry","hurt","ill","important","impossible","inexpensive","innocent","inquisitive","itchy","jealous","jittery","jolly","joyous","kind","lazy","light","lively","lonely","long","lovely","lucky","magnificent","misty","modern","motionless","muddy","mushy","mysterious","nasty","naughty","nervous","nice","nutty","obedient","obnoxious","odd","old-fashioned","open","outrageous","outstanding","panicky","perfect","plain","pleasant","poised","poor","powerful","precious","prickly","proud","putrid","puzzled","quaint","real","relieved","repulsive","rich","scary","selfish","shiny","shy","silly","sleepy","smiling","smoggy","sore","sparkling","splendid","spotless","stormy","strange","stupid","successful","super","talented","tame","tasty","tender","tense","terrible","thankful","thoughtful","thoughtless","tired","tough","troubled","ugliest","ugly","uninterested","unsightly","unusual","upset","uptight","vast","victorious","vivacious","wandering","weary","wicked","wide-eyed","wild","witty","worried","worrisome","wrong","zany","zealous"],Ve=["Actor","Gold","Painting","Advertisement","Grass","Parrot","Afternoon","Greece","Pencil","Airport","Guitar","Piano","Ambulance","Hair","Pillow","Animal","Hamburger","Pizza","Answer","Helicopter","Planet","Apple","Helmet","Plastic","Army","Holiday","Portugal","Australia","Honey","Potato","Balloon","Horse","Queen","Banana","Hospital","Quill","Battery","House","Rain","Beach","Hydrogen","Rainbow","Beard","Ice","Raincoat","Bed","Insect","Refrigerator","Belgium","Insurance","Restaurant","Boy","Iron","River","Branch","Island","Rocket","Breakfast","Jackal","Room","Brother","Jelly","Rose","Camera","Jewellery","Russia","Candle","Jordan","Sandwich","Car","Juice","School","Caravan","Kangaroo","Scooter","Carpet","King","Shampoo","Cartoon","Kitchen","Shoe","China","Kite","Soccer","Church","Knife","Spoon","Crayon","Lamp","Stone","Crowd","Lawyer","Sugar","Daughter","Leather","Sweden","Death","Library","Teacher","Denmark","Lighter","Telephone","Diamond","Lion","Television","Dinner","Lizard","Tent","Disease","Lock","Thailand","Doctor","London","Tomato","Dog","Lunch","Toothbrush","Dream","Machine","Traffic","Dress","Magazine","Train","Easter","Magician","Truck","Egg","Manchester","Uganda","Eggplant","Market","Umbrella","Egypt","Match","Van","Elephant","Microphone","Vase","Energy","Monkey","Vegetable","Engine","Morning","Vulture","England","Motorcycle","Wall","Evening","Nail","Whale","Eye","Napkin","Window","Family","Needle","Wire","Finland","Nest","Xylophone","Fish","Nigeria","Yacht","Flag","Night","Yak","Flower","Notebook","Zebra","Football","Ocean","Zoo","Forest","Oil","Garden","Fountain","Orange","Gas","France","Oxygen","Girl","Furniture","Oyster","Glass","Garage","Ghost"];var ko=()=>{let e=Ke[Math.floor(Math.random()*Ke.length)],t=Ve[Math.floor(Math.random()*Ve.length)];return`${e.toLowerCase()}-${t.toLowerCase()}`},Re=ko;var or={root:{root:"/"},tradeStore:{root:"trade-store",prefabs:"prefabs",blueprints:"blueprints"},docs:{root:"docs",gettingStarted:"getting-started",prefabs:"prefabs",config:"config-file",blueprints:"blueprints",telemetry:"telemetry",init:"initialise-a-project",resolvers:"resolvers",indexes:"indexes"}};var L=(e,t)=>{let{websiteUrl:r}=g,o=e.split("/"),i=or,s=o[0]||"./",n=o.map(a=>{var u;return a===s?a:(u=i[s])==null?void 0:u[a]});return`${r}/${n.join("/")}${t?`#${t}`:""}`};var jo=e=>e.startsWith("/")||e.startsWith("./")||e.startsWith("..")||e.startsWith("~")?"local":"remote",R=jo;var ir=e=>{let t=/^(?:[a-zA-Z:]+_[a-zA-Z:]+)+$/,r=/^(?:[A-Z]{1}[a-zA-Z:]+[A-Z]{1}[a-zA-Z:]+)+$/,o=/^(?:[a-z]{1}[a-zA-Z:]+[A-Z]{1}[a-zA-Z:]+)+$/,i=/^(?:[a-zA-Z:]+ [a-zA-Z:]+)+$/,s=/^(?:[a-zA-Z:]+-[a-zA-Z:]+)+$/;return t.test(e)?"snake":r.test(e)?"pascal":o.test(e)?"camel":i.test(e)?"sentence":s.test(e)?"kebab":"unknown"};var pe=e=>e.replace(/\s{2,}/g," ").trim(),sr=e=>{let t=ir(e),r=e.split(/(?=[A-Z:])/).filter(i=>i!==":"),o=r.slice(1).map(i=>i.toLowerCase());if(t==="snake"){let i=e.replace(/_/g," ").toLowerCase().replace(/:/g," ");return pe(i)}if(t==="pascal"){let i=e.split(/(?=[A-Z])/).map(s=>s.toLowerCase()).join(" ").replace(/:/g," ");return pe(i)}if(t==="camel"){let i=r[0]||"";o.unshift(i.toLowerCase());let s=o.join(" ");return pe(s)}if(t==="kebab"){let i=e.replace(/-/g," ").replace(/:/g," ").toLowerCase();return pe(i)}return t==="sentence"?pe(e.replace(/:/g,"")):e};var Me=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],To=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],nr=["","","Twenty","Thirty","Fourty","Fifty","Sixty","Seventy","Eighty","Ninety"],Ie=e=>{let t=/\d+/g,r=e.match(t);if(r){let o=r.map(i=>{let s=parseInt(i,10);if(s<10)return":"+Me[s];if(s<20)return":"+To[s-10];if(s<100)return":"+nr[Math.floor(s/10)]+Me[s%10];if(s<1e3){let n=s%100===0,a=":"+Me[Math.floor(s/100)]+":Hundred";return n||(a+=":And:"+nr[Math.floor(s%100/10)]+":"+Me[s%10]),a}if(s<1e6)return Ie(Math.floor(s/1e3).toString())+":Thousand"+Ie((s%1e3).toString());throw new Error("Numbers larger than 1 million are not supported")}).join(":");return e.replace(t,o)}return e};var ar=e=>e.replace(/&/g,":And").replace(/@/g,":At").replace(/#/g,":Hash").replace(/\$/g,":Dollar").replace(/£/g,":Pound").replace(/%/g,":Percent").replace(/\+/g,":Plus").replace(/\*/g,":Asterisk");var Po=(e,t)=>t.startsWith("builda")||t.startsWith("run-s")||t.startsWith("run-p")||t.startsWith("npm-run-all")||t.startsWith("concurrently")?t:`builda x ${e}`,Le=Po;var Co=(e,t)=>{let o=ar(e),i=Ie(o),n=sr(i).split(" ");switch(t){case"snakeCase":return n.join("_").toLowerCase();case"kebabCase":return n.join("-").toLowerCase();case"pascalCase":return n.map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join("");case"camelCase":return n.map((a,u)=>u===0?a.charAt(0).toLowerCase()+a.slice(1):a.charAt(0).toUpperCase()+a.slice(1)).join("");case"sentenceCase":default:return n.map((a,u)=>u===0?a.charAt(0).toUpperCase()+a.slice(1):a.charAt(0).toLowerCase()+a.slice(1)).join(" ")}},$=Co;var M=({link:e,anchor:t,endText:r})=>(r=r||"for more information.",`

See `+lr.default.blue.underline(L(e,t))+" "+r);var V=c(require("chalk"));var cr=c(require("inquirer")),b=(e,t)=>{console.clear(),ne();let r=new cr.default.ui.BottomBar,o=process.stdout.columns;t=t||"info";let i="bgBlue",s="i";t==="error"&&(i="bgRed",s="\u2716"),t==="success"&&(i="bgGreen",s="\u2714"),t==="warning"&&(i="bgYellow",s="\u26A0"),t==="builda"&&(i="bgMagenta",s="B\u0333");let n="  "+V.default.bold.white[i](`  ${s}  `),a="  "+V.default[i](" ".repeat(5))+" "+V.default[i](" ".repeat(o-10))+`
`,u=a+n+" "+V.default.bold.white[i](`  ${t.toUpperCase()}${" ".repeat(o-t.length-12)}
`)+a,d=V.default.white("\u2500".repeat(o)),m=e.replace(/\n/g,`
  `).replace(new RegExp(`(.{${o-20}})(\\s|$)`,"g"),`$1
  `);r.log.write(`
${u}\r
  ${V.default.white(m)}\r

${d}\r

`)};var l=e=>{let t=p(e,"danger",!0);throw new Error(t)};var ur=c(require("chalk")),Xe=c(require("process")),pr=c(require("readline")),Ro=e=>new Promise(t=>{let r=pr.default.createInterface({input:Xe.default.stdin,output:Xe.default.stdout});r.question(ur.default.blue(`\u{1F914} ${e} [y/N] `),o=>{o=o.toLowerCase(),r.close(),t(o==="y")})}),De=Ro;var dr=c(require("fs")),Mo=(e,t)=>dr.default.cpSync(e,t,{dereference:!0,recursive:!0,force:!0}),H=Mo;var ae=c(require("fs")),et=c(require("path")),fr=(e,t)=>{ae.default.existsSync(t)||ae.default.mkdirSync(t,{recursive:!0}),ae.default.readdirSync(e).forEach(r=>{let o=et.default.resolve(e,r),i=et.default.join(t,r);ae.default.lstatSync(o).isDirectory()?fr(o,i):ae.default.cpSync(o,i,{recursive:!0,dereference:!0})})},le=fr;var Oe=c(require("fs"));var We=c(require("path")),Io=e=>{if(Oe.default.existsSync(We.default.resolve(process.cwd(),"package.json"))){let o={...JSON.parse(Oe.default.readFileSync(We.default.resolve(process.cwd(),"package.json"),"utf8")),builda:e===null?void 0:{...e}};Oe.default.writeFileSync(We.default.resolve(process.cwd(),"package.json"),JSON.stringify(o,null,2))}else l("No package.json found in project")},Z=Io;var tt=c(require("fs")),Lo=async e=>{try{return tt.default.existsSync(e)||tt.default.mkdirSync(e,{recursive:!0}),!0}catch{return!1}},j=Lo;var rt=c(require("fs"));var ot=c(require("path")),Do=e=>{if(rt.default.existsSync(ot.default.resolve(process.cwd(),"package.json"))){let r=JSON.parse(rt.default.readFileSync(ot.default.resolve(process.cwd(),"package.json"),"utf8")).builda;if(!r&&!e)l('No "builda" entry found in package.json');else if(!r&&e)return{};return r}return l("No package.json found in project")},k=Do;var de=c(require("fs"));var X=c(require("path")),Oo=(e,t)=>{let r=[],i=de.default.readFileSync(e,"utf8").split(`
`);for(let s of i)if(s!==""&&s.startsWith("@extends")){let n=s.split(" ")[1];if(de.default.existsSync(X.default.resolve(t,n))){let u=de.default.readFileSync(X.default.resolve(t,n),"utf8").split(`
`);for(let d of u)if(d!==""&&!d.startsWith("#"))if(n!=null&&n.includes("/")){let f=n.split("/").pop(),m=n.replace(f,"");r.push(X.default.join(m,d))}else r.push(d)}else l(`File ${n} does not exist. Please check your .buildaignore file.`)}else if(s!==""&&s.startsWith("@"))l(`Invalid line in .buildaignore file: ${s}. Only @extends is allowed to start with @.`);else{if(s!==""&&s.startsWith("!"))continue;s!==""&&!s.startsWith("#")&&r.push(s)}return[...new Set(r)]},Wo=(e,t)=>{let r=[];for(let o of t){let i=X.default.join(e,o);o.includes("*")||(o.includes("/")?r.push(i):r.push(`**/${o}`))}return r},Bo=(e,t)=>{let r=t?"module":X.default.join(e,"modules","prefab"),o=X.default.resolve(r,".buildaignore");if(de.default.existsSync(o)){let i=Oo(o,r);return Wo(r,i)}return[]},ee=Bo;var D=c(require("path")),Be=c(require("fs")),mr=c(require("glob"));var it=async({name:e,paths:t,ignore:r,substitute:o,fromRoot:i=!1,fromCustomPath:s,toRoot:n=!1})=>{let{buildaDir:a}=g,u=D.default.join(a,"modules","prefab"),d=D.default.join(a,"export"),f=[];for(let m of t){let h=i?m:D.default.join(u,m);if(!(r&&ce(a,h)))if(m.includes("*")){let w=mr.default.sync(h).map(v=>D.default.relative(u,v));f.push(await it({name:e,paths:w,ignore:r,substitute:o,fromRoot:i,fromCustomPath:s,toRoot:n}))}else if(Be.default.lstatSync(h).isDirectory()){let v=Be.default.readdirSync(h).map(y=>D.default.join(m,y));f.push(await it({name:e,paths:v,ignore:r,substitute:o,fromRoot:i,fromCustomPath:s,toRoot:n}))}else f.push(new Promise(w=>{let v=D.default.dirname(m),y=D.default.basename(m),P=D.default.join(d,v),B=s||D.default.join(process.cwd(),"..",".."),N=D.default.join(B,v);if(!ce(a,h)){if(j(P),Be.default.existsSync(h)){let Ce=o.map(O=>O.reverseInExport?{...O,replace:O.with,with:O.replace}:O);Q({file:h,outputDir:P,substitute:Ce,name:e}),n&&(j(N),Q({file:h,rename:y.replace("unique.",""),outputDir:N,substitute:o,name:e}))}w(h)}}))}await Promise.all(f)},te=it;var st=c(require("fs")),nt=c(require("path"));var gr=c(require("prettier")),qo=["css","html","js","jsx","json","less","md","mdx","scss","sass","ts","tsx","yaml","yml","graphql"],zo=({file:e,rename:t,content:r,outputDir:o,substitute:i,name:s})=>{let n=e;t&&(n=t),n=n==null?void 0:n.split("/").pop();let a=e?st.default.readFileSync(nt.default.resolve(e),"utf8"):"",u=r??a;s&&(u=a.replace(/prefab-name-replace-string/g,$(s,"kebabCase")).replace(/%KEBAB_CASE%/g,$(s,"kebabCase")).replace(/%CAMEL_CASE%/g,$(s,"camelCase")).replace(/%SNAKE_CASE%/g,$(s,"snakeCase")).replace(/%PASCAL_CASE%/g,$(s,"pascalCase")).replace(/%SENTENCE_CASE%/g,$(s,"sentenceCase"))),i&&i.length>0&&i.forEach(f=>{let m=`${f.replace}`,h=new RegExp(m,"g");u=u.replace(h,f.with)});let d=n==null?void 0:n.split(".").pop();if(d&&qo.includes(d)&&(u=e?gr.default.format(u,{filepath:nt.default.resolve(e)}):u),u)return st.default.writeFileSync(`${o}/${n}`,u);throw new Error(`Could not write file ${n}`)},Q=zo;var Uo=c(require("fs")),Jo=c(require("path")),Go=c(require("process"));var at=c(require("fs")),qe=c(require("path"));var{buildaDir:Yo}=g,fe=async(e,t,r)=>{let o=qe.default.join(t,Yo,"modules","prefab");e.forEach(async i=>{let s=qe.default.join(o,i);at.default.cpSync(s,qe.default.join(t,i),{recursive:!0}),r&&at.default.rmSync(s,{recursive:!0,force:!0})})};var re=c(require("path")),lt=c(require("fs"));var me=c(require("path")),ge=c(require("fs"));var hr=async()=>{if(ge.default.existsSync(me.default.resolve(process.cwd(),"package.json"))){let e=JSON.parse(ge.default.readFileSync(me.default.resolve(process.cwd(),"package.json"),"utf8")),t=JSON.parse(ge.default.readFileSync(me.default.resolve(process.cwd(),g.buildaDir,"modules","prefab","package.json"),"utf8")),r=t.scripts,o=e.scripts,i=Object.keys(o).filter(a=>!Object.keys(r).includes(a)),s={...r};i.forEach(a=>{s[a]=o[a]});let n={...t,dependencies:{...e.dependencies},devDependencies:{...e.devDependencies},peerDependencies:{...e.peerDependencies},scripts:s};ge.default.writeFileSync(me.default.resolve(process.cwd(),g.buildaDir,"export","package.json"),JSON.stringify(n,null,2))}else l("No package.json found in project")};var _o=async({type:e,pathString:t})=>{var n,a;let r=process.cwd(),o=re.default.join(r,g.buildaDir,"export"),i=await A(o),s=ee(re.default.join(r,g.buildaDir));if(e==="copy")return t==="package.json"?void 0:H(`${r}/${t}`,re.default.join(o,t));if(e==="update"){if(t==="package.json")return hr();let u=(a=(n=i.generatorOptions)==null?void 0:n.rootFiles)==null?void 0:a.find(d=>typeof d=="string"||!d.substitutions||d.substitutions.length===0?!1:d.path===t);if(lt.default.rmSync(re.default.join(o,t),{recursive:!0,force:!0}),u)await te({name:i.name,paths:[t],ignore:s,fromRoot:!0,substitute:u.substitutions});else return H(`${r}/${t}`,re.default.join(r,g.buildaDir,"export",t))}if(e==="delete")return t==="package.json"&&l("package.json deleted. This will break your project"),lt.default.rmSync(re.default.join(o,t),{recursive:!0,force:!0})},z=_o;var Ho=(e,t)=>{let r=ee(e);for(let o of r)if(o.startsWith("**/")){let i=o.replace("**/",""),s=t.split("/").pop();if(i.includes(s))return!0}else if(o===t)return!0;return!1},ce=Ho;var he=c(require("fs")),yr=c(require("tar")),br=c(require("path"));var Zo=async(e,t,r)=>{he.default.existsSync(`${e}/${r}.tgz`)?(he.default.copyFileSync(`${e}/${r}.tgz`,`${t}/${r}.tgz`),await yr.default.extract({file:`${t}/${r}.tgz`,cwd:t}),he.default.unlinkSync(`${t}/${r}.tgz`)):l("No tarball found. Please run `builda package` first")},Qo=async(e,t)=>{let r=br.default.join(t||"./",g.buildaDir),o=await A(e),i=o.type==="blueprint"?`${r}/modules/blueprints/${o.name}`:`${r}/modules/prefab`;return await j(i),await Zo(e,i,"module"),he.default.writeFileSync(`${i}/registry.json`,JSON.stringify(o)),o},U=Qo;var ye=c(require("fs")),$r=c(require("path")),kr=c(require("axios")),Sr=c(require("tar"));var wr=c(require("fs")),xr=c(require("process"));var vr=c(require("axios")),Ko=async e=>{let t="registry.json";if(e=e||xr.default.cwd(),R(e)==="local")return JSON.parse(wr.default.readFileSync(`${e}/${t}`,"utf8"));let o=E({registryPath:e});o.error&&l(o.error);let i=o.url;i.includes("%FILE_NAME%")?i=i.replace("%FILE_NAME%",t):i=`${i}/${t}`;let s=await oe(i,!0);return s.status||l(s.message),vr.default.get(i,{responseType:"json"}).then(n=>n.data).catch(n=>{l(n.message)})},A=Ko;var Vo=async(e,t)=>{let r=$r.default.join(t||"./",g.buildaDir),o=await A(e),i=o.type==="blueprint"?`${r}/modules/blueprints/${o.name}`:`${r}/modules/prefab`;return await j(i),p(`Downloading ${o.name}...`,"downloading"),await kr.default.get(`${e}/module.tgz`,{responseType:"arraybuffer",headers:{"Content-Type":"application/gzip"}}).then(s=>ye.default.writeFileSync(`${i}/module.tgz`,s.data,{encoding:"binary"})).then(async()=>{if(ye.default.existsSync(`${i}/module.tgz`)){p("Extracting module files...","config");try{await Sr.default.extract({file:`${i}/module.tgz`,cwd:i}),ye.default.unlinkSync(`${i}/module.tgz`)}catch(s){l(s)}}}).catch(s=>{l(`There was an error downloading the tarball. Please check the URL and try again.

${s}`)}).finally(()=>{p("Copying the registry file...","copying"),ye.default.writeFileSync(`${i}/registry.json`,JSON.stringify(o,null,2))}),p("Done.","success"),o},J=Vo;var jr={builda:"https://builda.app/modules/%REPO_NAME%",github:"https://raw.githubusercontent.com/%REPO_NAME%",bitbucket:"https://bitbucket.org/%REPO_NAME%/raw"};var ei=({resolver:e,modulePath:t,version:r,resolvers:o})=>{let i=o[e];if(!i)return"";let s=i;return s.includes("%REPO_NAME%")?s=s.replace("%REPO_NAME%",t):s=s.replace(`${e}`,""),s.includes("%VERSION%")?s=s.replace("%VERSION%",r):s=`${s}/${r||"latest"}`,s.endsWith("/")&&(s=s.slice(0,-1)),ct(s)},Tr=ei;var ti=({registryPath:e,config:t})=>{var n;let r=e,o="",i=jr;if(r.startsWith("http")||r.startsWith("https")){let a=r;return r.includes("github.com")&&(a=r.replace("github.com","raw.githubusercontent.com").replace("/blob","").replace("/tree","")),r.includes("bitbucket.org")&&(a=r.replace("src","raw")),a.endsWith("/")&&(a=a.slice(0,-1)),{url:a,error:o}}let s=r.match(/^([a-z]+:{1}[/]{0})([a-z0-9-/]+)((?:@{1}v?[0-9.]+)?(?:[\w\d-]*))?$/);if(s){let a=((n=s[1])==null?void 0:n.replace(":",""))||"",u=s[2]||"",d=s[3]?s[3].replace("@",""):"latest";t&&t.resolvers&&(i={...i,...t.resolvers});let f=Tr({resolver:a,modulePath:u,version:d,resolvers:i});return f||(o=`Could not find a resolver for ${r}`),{url:f,error:o}}else return o='Paths must start with a colon terminated lowercase string with no spaces or special characters (e.g. "builda:" or "([a-z]+:{1}[/]{0})" ) if using a resolver or "http(s)" if using a url',{url:"",error:o}},E=ti;var Pr=c(require("fs")),Cr=c(require("path")),Ar=c(require("process"));var ri=(e,t,r)=>{if(t){let o=`${e}s`,i=Cr.default.resolve(Ar.default.cwd(),`${g.buildaDir}/modules/${o}/${r.use}`),s=JSON.parse(Pr.default.readFileSync(`${i}/registry.json`,"utf8"));return{path:i,registry:s}}throw new Error("Could not find config file")},ut=ri;var oi=({name:e,registry:t,script:r})=>{var s,n;let o=[],i=r!=null&&r.substitute&&((s=r.substitute)==null?void 0:s.length)>0?r==null?void 0:r.substitute:(n=t==null?void 0:t.generatorOptions)==null?void 0:n.substitutions;return i&&i.length&&i.forEach(a=>{var h;let u=a.with==="script"?e:a.with,d=(a==null?void 0:a.replace)||a.replace,m=(a==null?void 0:a.with)||u||"";!u&&!d&&a.required&&l(`"--${a.replace}" missing in arguments. This is required.
`),m&&!d&&o.push({replace:d.toUpperCase(),with:m}),d&&(m===""&&l(`"--${a.replace}" requires a value`),a.valid&&m!==""&&!((h=a.valid)!=null&&h.includes(m))&&l(`
"${m}" is not a valid ${a.replace}. Please use one of the following: 
 - ${a.valid.join(`
 - `)}
`),o.push({replace:a.replace.toUpperCase(),with:m}))}),o},pt=oi;var Fr=c(require("axios")),Nr=c(require("ajv"));var Er={$schema:"http://json-schema.org/draft-07/schema#",definitions:{ModuleConfig:{additionalProperties:{$ref:"#/definitions/ModuleConfigContents"},type:"object"},ModuleConfigContents:{additionalProperties:!1,properties:{location:{description:"The location of the module. This can be a local path, a remote url, a resolver or 'prefab' (if preinstalled inside a prefab)",type:"string"},outputDir:{description:"If the module should have a custom output directory, specify it here (relative to the app_root)",type:"string"},resolve:{anyOf:[{type:"string"},{additionalProperties:!1,properties:{type:{type:"string"},url:{type:"string"}},required:["url","type"],type:"object"}],description:"The custom resolver to use for the module"},version:{description:"The version of the module (not required for blueprints preinstalled inside a prefab)",type:"string"}},required:["location"],type:"object"},ModuleRegistry:{additionalProperties:!1,description:"See (https://builda.app/docs/build-a-module/registry) for more info",properties:{author:{additionalProperties:!1,description:"The module author's details",properties:{buildaUser:{description:"The builda username of the author. This is optional but is required if you want to publish your module to the builda trade store (see (https://builda.app/docs/trade-store))",type:"string"},email:{description:"The author's email",type:"string"},name:{description:"The author's name",type:"string"},website:{description:"The author's website",type:"string"}},required:["name"],type:"object"},blueprints:{$ref:"#/definitions/ModuleConfig",description:"If the module is a prefab and requires blueprints or has it's own blueprints, you should add them here if the module is a blueprint, this field is ignored",examples:["github:cool-developer/blueprint-cool-module@3.0.0","internal:blueprint-name"]},funding:{description:"Is this module looking for funding? If so, you can add a list of funding links here.",items:{type:"string"},type:"array"},generatorOptions:{additionalProperties:!1,description:"A set of options which will be passed to the module generator when the module has been installed",properties:{extraFolders:{description:"Extra folders which should be created in the module root when the module is installed (Will create any folders which don't already exist in the tree)",items:{type:"string"},type:"array"},substitutions:{additionalProperties:!1,description:"A set of substitutions which should be made in the module files when the module is installed",type:"array",items:{$ref:"#/definitions/TSubstitution"}},postScripts:{description:"Any post install scripts which should be run after the module has been installed and all files have been copied across and substitutions made (script paths are relative to the module root and should be in the form of a node cli script)",items:{type:"string"},type:"array"},rootFiles:{description:"Any files which should be copied to the module root when the module is installed in addition to the default files (see (https://builda.app/docs/build-a-module/prefabs#root-files)) e.g. .env files",items:{type:"string"},type:"array"}},type:"object"},keywords:{description:"The module keywords (optional but recommended if you want to publish your module to the builda trade store)",items:{type:"string"},type:"array"},name:{description:"The name of the module",type:"string"},prerelease:{default:!1,description:"If this is a prerelease, set this to true",type:"boolean"},publishToTradeStore:{default:!1,description:"Do you want to publish this module to the builda trade store? (see (https://builda.app/docs/trade-store))",type:"boolean"},type:{description:"The module type",enum:["blueprint","prefab"],type:"string"},url:{description:"The url of the module (generally a git repository) You can also use resolver aliases here. See (https://builda.app/docs/resolvers)",type:"string"},version:{description:"The module version number (in semver format)",pattern:"^\\d+\\.\\d+\\.\\d+$",type:"string"}},required:["name","type","version","url"],type:"object"},RootFile:{additionalProperties:!1,properties:{path:{description:"The path to the root file (relative to the .builda/export directory)",type:"string"},rewrite:{default:!1,description:"Should the file contents be rewritten with the default substitutions? https://builda.app/docs/build-a-module/substitutions",type:"boolean"},substitutions:{description:"Are there any custom substitutions to be made? see (https://builda.app/docs/build-a-module/substitutions)",items:{$ref:"#/definitions/TSubstitution"},type:"array"}},required:["path","substitutions"],type:"object"},TSubstitution:{additionalProperties:!1,properties:{replace:{description:"The string to be replaced",pattern:"^%[A-Z_]+%$",type:"string"},required:{default:!1,description:"Is this substitution required? (i.e. if it is not found, should the build fail?)",type:"boolean"},valid:{description:"Do you want to provide a list of valid options for this substitution? (i.e. if it is not found, should the build fail?)",items:{type:"string"},type:"array"},with:{description:"The string to replace with",type:"string"}},required:["replace","with"],type:"object"}}};var si=new Nr.default,oe=async(e,t)=>{let r=e;if(!t){let i=E({registryPath:e});if(i.error)return{status:!1,message:i.error};r=i.url}let o=r.includes("registry.json")?r:`${r}/registry.json`;return Fr.default.get(o).then(i=>{var a;if(!i.data)return{status:!1,message:"Something went wrong while fetching the registry. No data was returned and no error was provided."};let s=si.compile(Er);return s(i.data)?{status:!0,message:"Registry fetched successfully"}:((a=s.errors)==null||a.forEach(u=>{console.log(`Registry validation error: ${u.message}`)}),{status:!1,message:"The registry file is not valid. Please check the documentation for the correct format."})}).catch(i=>i.code==="ENOTFOUND"||i.code==="ERR_BAD_REQUEST"?{status:!1,message:"The url must point to a folder that contains a registry.json file"}:i.code==="ECONNREFUSED"?{status:!1,message:`The server at ${o} is not responding are you sure it is correct?`}:{status:!1,message:i.message})};var Ir=c(require("inquirer")),ze=c(require("chalk"));var Rr=[{name:"Test Blueprint",value:"github:builda-modules/blueprint-test"},{name:"Fake blueprint",value:""},{name:"Another fake blueprint",value:""},{name:"Yet another fake blueprint",value:""}];var Mr=async(e,t)=>{let r=await oe(e);if(r.status){if(t.prefabRegistry){let i=t.prefabRegistry.blueprints;return i&&i[e]?{status:!1,message:"A blueprint with that name already exists"}:{status:!0,message:""}}return{status:!0,message:""}}return{status:!1,message:r.message||"Could not validate the blueprint"}},dt=async e=>(b(`These questions are all about adding blueprints to your project.\r

If you're not sure what a blueprint is`+M({link:"docs/blueprints"})),Ir.default.prompt([{type:"confirm",name:"addBlueprints",message:()=>{let t=[],r=e.prefabRegistry,o=r==null?void 0:r.blueprints;return e.prefab&&o&&(t=Object.keys(o),b(`You are generating this project from the ${ze.default.blue(r.name)} prefab.

It comes with the following blueprints:

	`+t.map(i=>ze.default.blue(i)).join(`
	`)+`

Ensure that any additional blueprints you add are compatible with this prefab.`,"warning")),`Do you want to add any${t.length?"additional":""} blueprints to your project?`},default:!0},{type:"list",name:"blueprintChoice",message:"Do you have url(s) for your blueprint(s) or do you want to choose from a list?",choices:[{name:"I have url(s)",value:"url"},{name:"I want to choose from a list (coming soon)",value:"list",disabled:"This option is not available yet"}]},{type:"input",name:"blueprintUrls",message:"Enter the blueprint url(s) (if adding more than one, please separate them with a space):",when:t=>t.blueprintChoice==="url",validate:async t=>{if(!t)return"You must enter at least one url";let r=t.split(" ");for(let o of r){let i=await Mr(o,e);if(!i.status)return`The module at ${o} returned an error: ${i.message}`}return!0}},{type:"checkbox",name:"blueprintList",message:()=>(b("This list is not exhaustive. You can find more blueprints at "+ze.default.blue.underline(L("tradeStore/blueprints"))),"Choose your blueprints:"),choices:Rr,when:t=>t.blueprintChoice==="list",validate:async t=>{if(!t.length)return"You must choose at least one blueprint";for(let r of t){let o=await Mr(r,e);if(!o.status)return`The module at ${r} returned an error: ${o.message}`}return!0}}]));var be=c(require("fs")),Lr=c(require("inquirer")),ft=c(require("chalk"));var mt=async()=>{let e=()=>{try{return JSON.parse(be.default.readFileSync("package.json","utf8"))}catch{return""}};e()||(b("You must have a package.json file in the root of your project to add to an existing project.","error"),process.exit(1));let{name:t}=e(),o=(()=>!!(be.default.existsSync("lerna.json")||e().workspaces))(),s=(()=>be.default.existsSync("yarn.lock")?"yarn":be.default.existsSync("package-lock.json")?"npm":"unknown")();return Lr.default.prompt([{type:"input",name:"projectName",message:`We think your project is called ${ft.default.bold.magenta(t)}. Press enter if correct? If not, enter the correct name here.`,default:t},{type:"input",name:"appRoot",message:()=>(b(`The app root is the directory where your app files are stored.

This is usually your current working directory but if you are using a monorepo or if you'd like to store your app files in a different directory, you can specify it here it here.

If you're not sure, just press enter to use the current working directory.`),`We think your app root ${o?"may be in a monorepo, please enter the package name. If it is not a monorepo, just press enter to use ./ or specify the directory your app is store in":"is ./"}`),default:"./"},{type:"list",name:"packageManager",message:()=>(b("Builda works with both npm and yarn. If you are using a different package manager, unfortunately, Builda may not work for you."),"We think you are using "+ft.default.bold.magenta(s)+". Press enter if correct? If not, select the correct package manager."),choices:["npm","yarn"],default:s}])};var Dr=c(require("inquirer")),Or=c(require("chalk"));var gt=async e=>{let t=Re();return e&&b(`Great! That prefab is ready to install!

First things first though, we need a few more details, to get you set up.`,"success"),Dr.default.prompt([{type:"input",name:"appName",required:!0,message:`What do you want to call your project? This will also be the folder name we will create for your app. (If you don't know, just press enter to use ${Or.default.bold.magenta(t)})`,default:t}])};var Br=c(require("inquirer")),we=c(require("chalk"));var Wr=[{name:"Test Prefab",value:"github:builda-modules/prefab-test"},{name:"Fake prefab",value:""},{name:"Another fake prefab",value:""},{name:"Yet another fake prefab",value:""}];var ht=async()=>(b(`These questions are all about building a project from a prefab.

If you're not sure what a prefab is, visit `+we.default.blue.underline(L("docs/prefabs"))+we.default.white(" for more information.")),Br.default.prompt([{type:"list",name:"prefabChoice",message:"Do you have a prefab url or do you want to choose from a list?",choices:[{name:"I have a url",value:"url"},{name:"I want to choose from a list (coming soon)",value:"list",disabled:"This option is not available yet"}]},{type:"input",name:"prefabUrl",message:()=>(b("The url should point to the folder that the prefabs registry.json file is in. It can be a regular link or use a resolver."+M({link:"docs/resolvers"})),"Enter the prefab url:"),when:e=>e.prefabChoice==="url",validate:async e=>{if(!e)return"You must enter a url";let t=await oe(e);return t.status!==!0&&we.default.red(t.message),t.status}},{type:"list",name:"prefabList",message:()=>(b("This list is not exhaustive. You can find more prefabs at "+we.default.blue.underline(L("tradeStore/prefabs"))),"Choose a prefab:"),choices:Wr,when:e=>e.prefabChoice==="list"}]));var li=e=>e.startsWith("http")||e.startsWith("https")?e:`https://${e}`,ct=li;var qr=c(require("axios")),W=c(require("fs")),T=c(require("path"));async function zr(e,t,r,o,i,s,n,a,u){var O,_e,Ae,Xt;if(R(e)==="remote"){let x=E({registryPath:e}).url;x||l("No registry found"),t=await J(x,r)}else t=await U(e,r);t!=null&&t.name||l("No prefab found");let d=t.name,f=t.version,m=ee(n);p(`Installed ${d}@${f}`,"success"),p("Creating export path...","processing"),le(o,i),p("Export path created","success"),p("Copying required files to application...","copying");let h=T.default.join(i,n),w=W.default.readFileSync(T.default.resolve(i,"package.json"),{encoding:"utf8"}),v=JSON.parse(w),y={...v,name:$(s,"kebabCase")};(_e=(O=t==null?void 0:t.generatorOptions)==null?void 0:O.rootFiles)==null||_e.forEach(async x=>{let se=typeof x=="string"?x:x.path,I=T.default.dirname(se),q=T.default.basename(se);if(typeof x=="string")await fe([x],r);else{let Y=x.substitutions??[];await te({name:s,paths:[x.path],ignore:m,substitute:Y,fromCustomPath:r,toRoot:!0})}if(q.startsWith("unique.")){W.default.unlinkSync(T.default.join(i,I,q));let Y=q.replace("unique.","");p("Found unique file","processing"),W.default.renameSync(T.default.join(r,I,q),T.default.join(r,I,Y)),p(`Renamed unique file to: ${Y}`,"success");let _=v.builda||{},He={..._,ignored:[..._.ignored||[],T.default.join(I,Y)]};y.builda=He}}),(Xt=(Ae=t==null?void 0:t.generatorOptions)==null?void 0:Ae.extraFolders)==null||Xt.forEach(async x=>{W.default.mkdirSync(T.default.join(r,x),{recursive:!0}),W.default.writeFileSync(T.default.join(r,x,".gitkeep"),"")});let P=v.scripts,B={};Object.entries(P).forEach(([x,se])=>{B[x]=Le(x,se)}),y.scripts=B,W.default.writeFileSync(T.default.join(r,"package.json"),JSON.stringify(y,null,2));let N=`${a}/assets/prefab-getting-started.md`,Ce=[{replace:"%PREFAB_NAME%",with:d},{replace:"%PREFAB_URL%",with:t.url},{replace:"%PREFAB_VERSION%",with:f}];if(await qr.default.get(N,{headers:{"Content-Type":"text/plain"}}).then(x=>{x.status===200&&Q({content:x.data,rename:u,outputDir:r,substitute:Ce})}).catch(x=>{console.log(x),p(`Could not download the getting started file. Visit ${a}/docs/getting-started#prefab for assistance`,"warning")}),W.default.existsSync(h)&&W.default.rmSync(h,{recursive:!0}),t.blueprints){p("Installing prefab blueprints...","installing");let x=[],se=Object.keys(t.blueprints);for(let I of se){let q=t.blueprints[I];p(`Installing blueprint: "${I}"`,"processing");let Y=T.default.join(r,n,"modules","blueprints");if(j(Y),q.location==="prefab"){let _=T.default.join(o,n,"modules","blueprints",I);W.default.existsSync(_)&&le(_,T.default.join(Y,I))}else{let _=R(q.location);x.push(new Promise(He=>{if(_==="local"&&U(q.location,r),_==="remote"){let er=E({registryPath:q.location}).url;er||l("No registry found"),J(er,r)}He(I)}))}p(`${I} installed`,"success")}await Promise.all(x)}return p("All files copied to application.","success"),t}var xe=async({appName:e,prefab:t,smokeTest:r})=>{let{buildaDir:o,websiteUrl:i,buildaReadmeFileName:s}=g;ne();let n={};if(!t){let{usePrefab:y}=await Jr.default.prompt([{type:"confirm",name:"usePrefab",message:"Do you want to set the project up using a prefab?",default:!0}]);if(y){let P=await ht();n.prefab=P.prefabUrl||P.prefabList}else b(`You can set up a project from scratch by answering a few questions about your project.\r

If you are unsure about any of these, you can always change them later by editing the 'builda' section of your package.json file.`);n.prefab&&b(`Great! That prefab is ready to install!

First things first though, we need a few more details, to get you set up.`,"success")}let a={};(!t||!e)&&(a=await gt()),n={...n,...a};let u=e||n.appName,d=t||n.prefab,f=$(u,"kebabCase"),m=Ue.default.join(Je.default.cwd(),f);await j(f),Je.default.chdir(f);let h=Ue.default.join(m,o,"export"),w=Ue.default.join(m,o,"modules","prefab");yt.default.readdirSync(m).length!==0&&l(`The directory: '${f}' already exists. It is not recommended to install a prefab into an existing project.`),await j(h),d&&await zr(d,{},m,w,h,u,o,i,s),p(`Your application, "${u}" has been initialised!`,"success"),r?(Je.default.chdir("../"),yt.default.rm(u,{recursive:!0,force:!0},y=>{y&&console.log(y),p("This was a smoke test. No files were created.","primary")})):((0,Ur.default)("cd",[u]),p(`For more information about how to use your application, visit: ${i}/docs/getting-started`,"primary"))};var bt=()=>({command:"project [appName]",desc:"Generate a new app from a prefab",aliases:["app","--app","--project"],builder:e=>e.positional("appName",{describe:"The name of the app",type:"string",default:""}).option("prefab",{alias:"p",default:"",describe:"The prefab to use (url, local path, or preset name)",type:"string"}).option("smokeTest",{alias:"s",default:!1,describe:"Runs the command but deletes the output immediately",type:"boolean"}),handler:async e=>{let t={appName:e.appName,prefab:e.prefab,smokeTest:e.smokeTest};await xe({...t})}});var wt=c(require("chalk")),ve=c(require("process")),ie=c(require("path")),ue=c(require("fs")),Gr=c(require("execa"));var xt=async({command:e,args:t})=>{var d;let r=ve.default.cwd(),o=ie.default.join(ve.default.cwd(),g.buildaDir,"export");r.split("/").pop()==="export"&&(o=r);let i=ue.default.readFileSync(ie.default.resolve(o,"package.json"),{encoding:"utf8"}),a=JSON.parse(i).scripts[e],u="";ue.default.existsSync(ie.default.resolve(r,"yarn.lock"))&&ue.default.existsSync(ie.default.resolve(r,"package-lock.json"))?l("Builda detected a yarn.lock file and a package-lock.json file. Please delete one of these files and try again"):ue.default.existsSync(ie.default.resolve(r,"yarn.lock"))?u="yarn":ue.default.existsSync(ie.default.resolve(r,"package-lock.json"))?u="npm":l("Builda could not detect a yarn.lock or package-lock.json file. Please run `yarn` or `npm install` and try again"),a||l(`No script found with the name '${e}'`),o||l(`No path found for script '${e}'`),e||l("No command found");try{let f=`${u} run ${e}`;if(t){let m=Object.keys(t),h=Object.values(t),w=m.reduce((v,y,P)=>{let B=h[P],N="";return y==="_"||y==="command"||y==="$0"?v:(y.length===1?N=`-${y}`:N=`--${y}`,B&&typeof B=="boolean"?` ${v} ${N}`:` ${v} ${N}="${B}"`)},"");f=`${f}${w}`}ve.default.stdout.write(wt.default.magenta("Running with Builda: ")+wt.default.white.bold(`'${f}'`)+`
`),(d=Gr.default.command(f,{cwd:o,stdio:"inherit"}).stdout)==null||d.pipe(ve.default.stdout)}catch(f){l(f.message)}};var vt=()=>({command:"execute <command>",desc:"Execute a command from within the export directory",aliases:["x","exec"],builder:e=>e.positional("command",{describe:"The name of the command",type:"string",demandOption:!0}),handler:async e=>xt({command:e.command,args:e})});var $e=c(require("process")),$t=c(require("fs"));var kt=async({pathString:e})=>{var i;let t=k();e||l("A path must be provided"),(i=t.ejected)!=null&&i.includes(e)&&l(`${e} has already been ejected.`);let r=e.replace(`${$e.default.cwd()}/`,""),o=`${$e.default.cwd()}/.builda/export/${r}`;try{$t.default.existsSync(o)||l(`No file found at ${o}.`),p(`Moving ${r} to application...`,"info"),fe([r],$e.default.cwd()),p(`Deleting original from ${o}`,"info"),$t.default.rmSync(o,{recursive:!0,force:!0});let s=e.replace(`${$e.default.cwd()}/`,""),n=t.ejected??[];n.push(s);let a={...t,ejected:n};Z(a),p(`Ejected ${e}. You can now edit this file directly.`,"success")}catch(s){l(s.message)}};var St=()=>({command:"eject <pathString>",desc:"Eject a file or directory from builda to make it editable",builder:e=>e.positional("pathString",{describe:"The path to the file or directory to eject",type:"string",demandOption:!0}).option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async e=>kt({pathString:e.pathString})});var C=c(require("fs")),F=c(require("path"));var ke=async()=>{let e=k(),{prefab:t,blueprints:r}=e,{buildaDir:o}=g,i=process.cwd(),s=F.default.join(i,o,"modules");if(C.default.existsSync(s)||C.default.mkdirSync(s,{recursive:!0}),p("Installing modules...","info"),p("Looking for prefab...","processing"),t){C.default.existsSync(F.default.join(s,"prefab"))?l("prefab directory already exists, aborting"):C.default.mkdirSync(s,{recursive:!0}),p("Prefab found","success"),t.location||l("No prefab location found"),t.location==="prefab"&&l('Prefab location cannot be "prefab". Please specify a specific location'),t.version||p("No prefab version specified, using the location entry as full path to prefab","warning");let n=t.version?`${t.location}/v/${t.version}`:t.location;if(R(n)==="remote"){let u=E({registryPath:n}).url;await J(u)}else await U(n);let a=F.default.join(s,"prefab");if(C.default.existsSync(a)){p("Prefab installed successfully","success"),p("Creating export folder...","processing");let u=F.default.join(i,g.buildaDir),d=F.default.join(u,"modules","prefab"),f=F.default.join(u,"export");C.default.existsSync(f)||(C.default.mkdirSync(f,{recursive:!0}),H(d,f),C.default.existsSync(F.default.join(f,g.buildaDir))&&C.default.rmSync(F.default.join(f,g.buildaDir),{force:!0,recursive:!0}),p("Export folder created successfully","success"))}else l("Prefab installation failed")}else p("No prefab found, skipping...","info");if(p("Looking for blueprints...","processing"),r){p("Blueprints found","success");let n=Object.entries(r);for(let[a,u]of n){if(!u.version&&u.location!=="prefab"&&p(`No version specified for ${a}, using location entry as full path to blueprint`,"warning"),u.location||l(`No blueprint path found for ${a}`),C.default.existsSync(F.default.join(s,"blueprints",a))?l(`blueprint ${a} already exists, aborting`):C.default.mkdirSync(s,{recursive:!0}),u.location==="prefab"){let d=F.default.join(s,"prefab",".builda","modules","blueprints",a);C.default.existsSync(d)?le(d,F.default.join(s,"blueprints",a)):l(`No blueprint found in prefab for ${a}`)}else{let d=u.version?`${u.location}/v/${u.version}`:u.location;if(R(d)==="remote"){let f=E({registryPath:d}).url;await J(f)}else await U(d)}C.default.existsSync(F.default.join(s,"blueprints",a))?p(`Blueprint ${a} installed successfully`,"success"):l(`Blueprint ${a} installation failed`)}}else p("No blueprints found, skipping...","info")};var jt=()=>({command:"install",desc:"Installs the applications prefab and builds the export directory",builder:e=>e.option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async()=>ke()});var Yr=c(require("path")),_r=c(require("process"));var Se=async({modulePath:e,fromScript:t})=>{var a;let r={},o=k(),i=_r.default.cwd(),s=Yr.default.join(i,g.buildaDir,"modules"),n=e.includes(" ")?e.split(" "):[e];await j(s);for(let u of n){if(R(u)==="remote"){let d=E({registryPath:u}).url;d||l("No registry found"),r=await J(d)}else r=await U(u);if(!t)if(r!=null&&r.name){let d=r.type,f=r.name,m=r.version;d==="blueprint"&&(o!=null&&o.blueprints||(o.blueprints={}),(a=o==null?void 0:o.blueprints)!=null&&a[f]?l(`A blueprint called ${f} already exists. Perhaps you meant 'builda update ${f}?'`):o.blueprints[f]={version:m,location:u}),d==="prefab"&&l("You cannot add a prefab as a module. A prefab is used to set up a new project. Try 'builda project' instead."),Z(o),p(`Added ${f} to your project`,"success")}else l("Something went wrong")}};var{websiteUrl:ci}=g,Tt=()=>({command:"add <blueprintPath>",desc:"Adds a new blueprint",builder:e=>e.positional("blueprintPath",{describe:`The path to the blueprint (can be a resolver - see http://${ci}/docs/resolvers)`,type:"string",demandOption:!0}).option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async e=>Se({modulePath:e.blueprintPath})});var G=c(require("fs")),Qr=c(require("tar"));var Hr=c(require("fs")),Zr=(e,t)=>Hr.default.existsSync(e)?{error:!1,message:""}:{error:!0,message:`Cannot find ${t&&"a folder called"} '${e}' in the current directory.`};var je=async e=>{let t=await A(),{name:r,type:o,version:i}=t,s="registry.json",n="module",a=[];if(G.default.existsSync(".npmignore")){let v=G.default.readFileSync(".npmignore","utf8").split(`
`);a.push(...v)}if(G.default.existsSync(`${n}/.gitignore`)){let v=G.default.readFileSync(`${n}/.gitignore`,"utf8").split(`
`).filter(y=>y!==""&&!y.startsWith("#"));a.push(...v)}t||l(`No ${s} file found. See ${M({link:"docs/packaging"})} for more information.`),r||l(`No name entry found in ${s}. Please add one.\r`),o||l(`No type entry found in ${s}. Please add one.\r`),!i&&!e&&l(`No version entry found in ${s}. Please add one.\r`);let u=Zr(n,!0);u.error&&l(u.message),r.startsWith(`${o}-`)||l(`The name entry in ${s} must be prefixed with ${o}-.\r`),p("All checks passed.","success");let f=(e==null?void 0:e.replace("v",""))||i,m={...t,version:f},h=JSON.stringify(m,null,2);if(G.default.writeFileSync(s,h),G.default.existsSync(`${n}.tgz`)){if(p("A module package already exists. Do you want to overwrite it?","warning"),!await De("Overwrite?")){p("Package process aborted","error");return}G.default.unlinkSync(`${n}.tgz`)}p(`Packaging ${r}...`,"processing"),await Qr.default.create({file:`${n}.tgz`,gzip:!0,cwd:n,filter:w=>!a.includes(w)},G.default.readdirSync(n)),p("Package created","success")};var Pt=()=>({command:"package",desc:"Package a module ready for publishing",aliases:["package","pack"],handler:async()=>je()});var Ct=c(require("fs")),eo=require("simple-git");var Kr=async()=>!0;var Vr=c(require("fs")),Xr=(e,t)=>Vr.default.existsSync(e)?{error:!1,message:""}:{error:!0,message:`Cannot find ${t&&"a folder called"} '${e}' in the current directory.`};var At=async e=>{let t=await A(),{name:r,type:o,version:i,publishToTradeStore:s}=t,n="registry.json",a="README.md",u="module.tgz";t||l(`No ${n} file found. Publish can only be ran in the context of a module`),r||l(`No name entry found in ${n}. Please add one.\r`),o||l(`No type entry found in ${n}. Please add one.\r`),!i&&!e&&l(`No version entry found in ${n}. Please add one.\r`),s||p(`No tradeStore entry found in ${n}.
This module will not be published to the Builda Trade Store (https://builda.app/trade-store).\r`,"info"),Ct.default.existsSync(u)||(p("No module package found. Building package...","processing"),await je(e),p("Package built","success")),r.startsWith(`${o}-`)||l(`The name entry in ${n} must be prefixed with ${o}-.\r`);let f=Xr(a);f.error&&l(f.message);let m=(0,eo.simpleGit)();m.checkIsRepo()||l("This is not a git repository. Please initialise git and try again.\r"),(await m.status()).isClean()||l("The git repository is not clean. Please commit all changes and try again.\r"),p("All checks passed.","success");let w=(e==null?void 0:e.replace("v",""))||i,v={...t,version:w},y=JSON.stringify(v,null,2);Ct.default.writeFileSync(n,y),p(`Adding ${u} to git...`,"processing"),await m.add(`${u}`),await m.commit(`Adds updated ${u}`),p("Added to git","success"),p("Tagging the latest commit...","processing");let P=await m.tags();(P.all.includes(w)||P.all.includes(`v${w}`))&&l(`A tag with the version number v${w} already exists. Please update the version number in ${n} and try again.\r`),await m.addTag(`v${w}`);let N="tags";if(t.prerelease)p("Prerelease entry found in registry.json. Skipping latest tag...","info"),N="tag";else{let O=(await m.listRemote(["--tags"])).includes("refs/tags/latest"),Ae=(await m.tags()).all.includes("latest");(O||Ae)&&(await m.tag(["--delete","latest"]),await m.push(["origin","--delete","latest"])),await m.addTag("latest")}await m.pushTags("origin"),p(`${N} created.`,"success"),p("Pushing changes to git...","processing"),await m.push(),p("Changes pushed to git.","success"),s&&(p("Publishing to the Builda Trade Store...","processing"),Kr()),p("Module published.","success")};var Et=()=>({command:"publish",desc:"publish a module",aliases:["pub","push"],builder:e=>e.option("version",{aliases:["v","ver"],default:"",describe:"update module version (semver)",type:"string"}),handler:async e=>At(e.version)});var to=c(require("chokidar"));var Ft=e=>{let{prefab:t}=e,r=[...e.ignored||[]];t||l("No prefab found in config file. Watch cannot be run without a prefab"),to.default.watch(".",{persistent:!0,ignoreInitial:!0,ignored:r}).on("change",i=>{console.log(`File ${i} has been changed`),z({type:"update",pathString:i})}).on("add",i=>{console.log(`File ${i} has been added`),z({type:"copy",pathString:i})}).on("addDir",i=>{console.log(`Directory ${i} has been added`),z({type:"copy",pathString:i})}).on("unlinkDir",i=>{console.log(`Directory ${i} has been deleted`),z({type:"delete",pathString:i})}).on("unlink",i=>{console.log(`File ${i} has been deleted`),z({type:"delete",pathString:i})}).on("ready",()=>{p("Watching for changes...","primary"),p("Press Ctrl+C to stop watching","secondary")})};var Nt=()=>({command:"watch",desc:"Watches your app for changes and rebuilds",aliases:["w"],builder:e=>e.option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async()=>{let e=await k();if(e!=null&&e.prefab)return Ft(e);(e==null?void 0:e.prefab)===void 0&&l("No prefab found in config file. Watch can only be run within a prefab"),l("No config file found")}});var It=c(require("fs")),Ge=c(require("path"));var ro=c(require("fs")),Rt=c(require("path"));var Mt=({directory:e,parent:t})=>{let r=ro.default.readdirSync(Rt.default.resolve(e));return r.length!==0?r.map(o=>{let i=t?`${t}/${o}`:o;if(!o.match(/\.[jt]sx$/))return`export { default as ${$(o,"pascalCase")} } from './${i}';`;let s=Rt.default.parse(o).name;return`export { default as ${$(s,"camelCase")} } from './${s}';`}).filter(o=>o).toString().replace(/,/g,`
`):""};var ui=`/**
 This file is autogenerated by Builda, please do not edit it.
 To generate an updated version, please run \`builda index\`
 **/`,Lt=e=>{let{indexes:t}=e;if(!t)l(`No indexes entry found in the config file. Index files cannot be generated. See ${L("docs/config","indexes")} for more information.`);else{let{directories:r,indexExt:o}=t,i=o||"ts";r.forEach(s=>{let n=s,a=[],u="";s.includes("*")?(n=s.replace("/*",""),a=It.default.readdirSync(Ge.default.resolve(n)),a.forEach(f=>{let m=Ge.default.resolve(`${n}/${f}`);return u+=`${Mt({directory:m,parent:f})}
`})):u=Mt({directory:s});let d=`${ui}

${u}`;u&&It.default.writeFileSync(Ge.default.resolve(n,`index.${i}`),d)}),p("Generating indexes","config")}};var Dt=()=>({command:"indexer",desc:"Generate an index file for the specified directories",aliases:["index"],builder:e=>e.option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async e=>{let t=await k();if(t)return Lt(t);l("No config file found")}});var Te=c(require("fs")),Ot=c(require("path"));var pi=e=>{if(e.scripts){let t={};return Object.entries(e.scripts).forEach(o=>{let i=o[0];t[i]=o[1]}),t}else return l('No "scripts" entry found in config file')},oo=pi;var so=c(require("inquirer"));var io=async(e,t,r,o,i)=>{let{buildaDir:s}=g,n=`${t}/${$(e,"kebabCase")}`,a=Ot.default.join(s,"export",n);Te.default.existsSync(n)&&l(`A ${o.use} already exists with the name ${e}`),Te.default.existsSync(a)&&l(`An existing ${o.use} with the name ${e} was found in the prefab. Continuing will overwrite this version.\r
If you want to edit the prefab version, you need to eject it with 'builda eject ${e}'`),Te.default.mkdirSync(n,{recursive:!0});let{path:u,registry:d}=ut("blueprint",r,o),f=(i==null?void 0:i.split(":"))||[],m=f.length===2?{replace:f[0],with:f[1]}:void 0,h=o?pt({registry:d,name:e,script:o,sub:m}):[],w=Ot.default.resolve(u,"module");return Te.default.readdirSync(w).forEach(v=>{let y=`${w}/${v}`,P=`${n}`;Q({file:y,rename:y.replace("temp_name",e),outputDir:P,substitute:h,name:e})}),r.prefab&&z({type:"copy",pathString:n}),p("Done!","success")},Wt=async({config:e,name:t,scriptName:r,subString:o})=>{let i=oo(e),s=i==null?void 0:i[r];if(s.use)if((!t||t==="")&&l(`You need to provide a name for your new ${r}`),p(`Building new ${r}: '${t}'...`,"notice"),s.variants){let n=await so.default.prompt([{type:"list",name:"variantChoice",message:`What type of ${r} do you wish to build?`,choices:s.variants.map(a=>({name:a.name,value:a.outputDir}))}]);await io(t,n.variantChoice,e,s,o)}else await io(t,s.outputDir,e,s,o);else l("No valid scripts found")};var Bt=()=>({command:"new <scriptName>",desc:"Create something new from a blueprint",builder:e=>e.positional("scriptName",{describe:"The blueprint script to run",type:"string",default:""}).positional("name",{describe:"The name of the new thing",type:"string",default:""}).option("subString",{aliases:["s","sub"],default:"",describe:`A string matcher for the blueprint script. e.g: "%MY_STRING%:'new string'"`,type:"string"}),handler:async e=>{let t=await k();if(t)return Wt({config:t,scriptName:e.scriptName,name:e.name});l("No config file found")}});var no=c(require("fs")),Ye=c(require("path"));var qt=async({config:e})=>{let{prefab:t}=e,r=process.cwd(),o=Ye.default.join(r,g.buildaDir),i=Ye.default.join(o,"modules","prefab");t||l("No prefab found in config file. Build cannot be run without a prefab");let s=[];p("Building your project","processing"),no.default.readdir(r,(n,a)=>{n&&l(n.message),a.forEach(u=>{ce(i,u)||H(`${r}/${u}`,Ye.default.join(`${g.buildaDir}/export`,u)),s.push(Promise.resolve(u))}),Promise.all(s).then(()=>{p("Build complete","success")})})};var zt=()=>({command:"build",desc:"Build your project",aliases:["-b","--build"],builder:e=>e.option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async()=>{let e=await k();if(e)return qt({config:e});l("No config file found")}});var Ut=c(require("fs")),ao=c(require("path"));var Jt=async()=>{let e=k(),{prefab:t}=e,{buildaDir:r}=g,o=ao.default.join(process.cwd(),r);Ut.default.existsSync(o)?Ut.default.rmdirSync(o,{recursive:!0}):t?(p("Prefab config found but no builda directory found.","warning"),p('Running "builda install" instead',"info")):l('No prefab found in config (perhaps you meant to run "builda init" instead?)'),await ke()};var Gt=()=>({command:"update",desc:"Updates the applications prefab to the latest version",builder:e=>e.option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async()=>Jt()});var Yt=c(require("fs")),lo=c(require("events")),_t=c(require("inquirer")),Pe=c(require("chalk"));var Ht=async({config:e})=>{lo.default.defaultMaxListeners=50;let{buildaDir:t}=g,r={projectName:"",appRoot:"",packageManager:""};if(e&&Object.keys(e).length!==0){e.prefab&&(b('This project was generated from a prefab and cannot be reinitialised. Maybe you meant to run "builda install" instead?',"error"),process.exit(1)),b(`It looks like builda has already been initialised in this project.
You can overwrite the existing config if you want to start again.\r

`+Pe.default.yellow("Be careful though")+", continuing will instantly delete any existing config and your"+t+" directory.","warning");let{overwrite:i}=await _t.default.prompt([{type:"confirm",name:"overwrite",message:Pe.default.red("Are you sure you want to reset the builda config?"),default:!1}]);i||(p("Process aborted at user request","notice"),process.exit(0)),Z(null),Yt.default.existsSync(t)&&Yt.default.rmSync(t,{recursive:!0})}b("Welcome to "+Pe.default.magenta("Builda")+" This is a guided setup process help you get your project up and running."+M({link:"docs/init",endText:`if you get stuck.

`})+Pe.default.white("You can exit the process at any time by pressing Ctrl+C."),"builda");let{initType:o}=await _t.default.prompt([{type:"list",name:"initType",message:"What would you like to do?",choices:[{name:"I want to start a new project",value:"new"},{name:"I want to add builda to an existing project",value:"existing"},{name:"I want to create my own prefab",value:"prefab"},{name:"I want to create my own blueprint",value:"blueprint"}]}]);if(o==="new"&&(b(`A fresh start! Let's get you set up with a new project.\r

You can choose to use a prefab to get started quickly, or you can set up a project from scratch.`),xe({})),o==="existing"){b(`You can add builda to an existing project by answering a few questions about your project.\r

If you are unsure about any of these, you can always change them later by editing the 'builda' entry in package.json.`);let i=await mt();r={...r,...i};let s=await dt(r);r={...r,...s};let n=r.blueprintUrls||r.blueprintList.join("");Z({}),Se({modulePath:n})}o==="prefab"&&(b(`You can create your own prefab by answering a few questions about your project.\r

If you are unsure about any of these, you can always change them later by editing the 'builda' entry in package.json.`+M({link:"docs/build-a-module",anchor:"prefab"})),console.log("Coming soon..."),process.exit(0)),o==="blueprint"&&(b(`You can create your own blueprint by answering a few questions about your project.\r

If you are unsure about any of these, you can always change them later by editing the 'builda' entry in package.json.\r

`+M({link:"docs/build-a-module",anchor:"blueprint"})),console.log("Coming soon..."),process.exit(0))};var Zt=()=>({command:"init",desc:"Initialise builda",builder:e=>e.option("configPath",{aliases:["c","config"],default:"",describe:"The path to a config file",type:"string"}),handler:async e=>{let t=await k(!0);return Ht({config:t||void 0})}});var co=c(require("inquirer")),Qt=async e=>co.default.prompt(e);var Kt=async e=>{var n,a;let t=await A(),r=(a=(n=t==null?void 0:t.generatorOptions)==null?void 0:n.rootFiles)==null?void 0:a.filter(u=>typeof u!="string"&&u.rewrite),o=(r==null?void 0:r.map(u=>u.path))??[],i=r==null?void 0:r.map(u=>u.substitutions??[]),s=[...e,...(i==null?void 0:i.flat())??[]];te({paths:o,substitute:s,fromRoot:!0,toRoot:!0})};var{websiteUrl:di}=g,Vt=async()=>uo.default.scriptName("builda").usage("$0 <cmd> [args]").help().demandCommand(1,'You need at least one command before moving on. Try "builda --help" for more information').command({...bt()}).command({...Zt()}).command({...zt()}).command({...Tt()}).command({...St()}).command({...jt()}).command({...Bt()}).command({...vt()}).command({...Pt()}).command({...Et()}).command({...Nt()}).command({...Gt()}).command({...Dt()}).epilogue(`For more information, visit ${po.default.blue.underline(`${di}/docs`)}`).argv;require.main===module&&Vt();var fi=Vt;0&&(module.exports={builda,buildaQuestion,buildaSubstitute,changeCase,printMessage,throwError});
